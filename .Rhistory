DE
"
(scatter_continents_repr_s <- scat_plot +
geom_text(data = subset(aggregates, repr_s == "Under" & continent != "Europe"),
aes(x = log(emig_immig), y = log(art_country), label = ISO3),
size = 3.5, check_overlap = T) +
geom_text(data = subset(aggregates, repr_s == "Under" & continent == "Europe"),
aes(x = log(emig_immig), y = log(art_country), label = ISO3),
size = 3, check_overlap = T) +
geom_text(data = subset(aggregates, ISO3 == "USA"),
aes(x = log(emig_immig), y = log(art_country), label = ISO3),
size = 3.5, check_overlap = T) +
ggh4x::facet_manual(~continent, design = design))
ggsave("../output_figures/scatter_continents_repr_s.png", width = 50, height = 25, units = "cm", dpi = 300, scale = 1, plot = last_plot())
# Remove legend before combining plots.
(map_repr_s_new <- map_repr_s + theme(legend.position = "none"))
scatter_continents_repr_s <- scatter_continents_repr_s + theme(legend.position = "none")
combined_map_scatter <- map_repr_s_new / scatter_continents_repr_s
combined_map_scatter +
inset_element(
only_legend,
left = 0.02, bottom = 0.9, right = 0.2, top = .9,
align_to = 'panel'
)
ggsave("../output_figures/figure_2.png", width = 50, height = 25, units = "cm", dpi = 500, scale = 1, plot = last_plot())
design = "
#A
BC
DE
"
(scat_plot_rel <- aggregates %>%
filter(!is.na(repr_rel_s)) %>%
ggplot(aes(x = log(mig_rel_index), y = log(art_country))) +
geom_point(aes(color = repr_rel_s)) +
geom_text(data = subset(aggregates, repr_rel_s == "Under"),
aes(x = log(mig_rel_index), y = log(art_country), label = ISO3),
check_overlap = T) +
scale_color_manual(values = c("#f0e6d2", "#6baed6", "#e34a33")) +
labs(color = "Research representation",
x = "Relative immigration + emigration (log)",
y = "Research salience (log)") +
theme_minimal() +
theme(legend.position = c(0.2, 0.9)) +
ggh4x::facet_manual(~continent, design = design))
ggsave("../output_figures/scatter_continents_repr_rel_s.png", plot = last_plot())
rm(list = ls())
Sys.setenv(LANG = "en")
library(tidyverse)      # Includes dplyr, ggplot2, readr, purrr, stringr
library(countrycode)
library(ggalluvial)
library(RColorBrewer)
library(viridis)
library(patchwork)
file_names <- c(
"composition_gsouth",
"composition_subregions",
"composition_continent",
"composition_income",
"composition_continents_ctry_time",
"composition_continents_ctry"
)
# Read CSVs into a named list
df_list <- map(file_names, ~read_csv(paste0("../outputs/", .x, ".csv")))
rm(list = ls())
Sys.setenv(LANG = "en")
library(tidyverse)      # Includes dplyr, ggplot2, readr, purrr, stringr
library(countrycode)
library(ggalluvial)
library(RColorBrewer)
library(viridis)
library(patchwork)
file_names <- c(
"composition_subregions",
"composition_continent",
"composition_income",
"composition_continents_ctry_time",
"composition_continents_ctry"
)
# Read CSVs into a named list
df_list <- map(file_names, ~read_csv(paste0("../outputs/", .x, ".csv")))
rm(list = ls())
Sys.setenv(LANG = "en")
library(tidyverse)      # Includes dplyr, ggplot2, readr, purrr, stringr
library(countrycode)
library(ggalluvial)
library(RColorBrewer)
library(viridis)
library(patchwork)
file_names <- c(
"composition_subregions",
"composition_continent",
"composition_income",
"composition_continents_ctry_time",
"composition_continents_ctry"
)
# Read CSVs into a named list
df_list <- map(file_names, ~read_csv(paste0("../aggregated_data/", .x, ".csv")))
names(df_list) <- file_names
# Assign each list element to a variable
list2env(df_list, envir = .GlobalEnv)
aggregates <- read_csv("../aggregated_data/aggregates.csv")
plot_composition <- function(df, var1, var2) {
if (is.character(var1) && is.character(var2)) {
var1 <- ensym(var1)
var2 <- ensym(var2)
}
df %>%
ggplot(aes(y = n, axis1 = !!var1, axis2 = !!var2)) +
geom_alluvium(aes(fill = !!var2)) +
geom_stratum() +
geom_label(stat = "stratum",
aes(label = after_stat(stratum)),
size = 3,
label.size = NA) +
theme(legend.position = "none") +
labs(y = "Country salience") +
scale_fill_viridis_d() +
scale_x_continuous(breaks = 1:2, labels = c("Country salience \n by region", "Composition of authors \n by region")) +
coord_cartesian(xlim = c(0.8, 2.13))
}
options(scipen = 999)
composition_subregions %>%
plot_composition("subregion_gr", "team_subregion")
ggsave("../output_figures/figure_S3B_subregions_alluvial.png", width = 7, height = 7, dpi = 500, limitsize = F, plot = last_plot())
# Choose a qualitative palette with up to 8–12 distinct colors
team_continent_cats <- c("Northern America", "Europe", "Asia", "Collaboration", "Africa", "Oceania", "Lat.America & Car.")
n_colors <- length(team_continent_cats)
custom_colors <- brewer.pal(n = n_colors, name = "Set2")
(continents_alluvial <- composition_continent %>%
plot_composition("continents_gr", "team_continent") +
geom_text(stat = "flow",
aes(label = paste0(as.character(round(percent)), '%')),
nudge_x = .25,
check_overlap = T,
size = 3)) +
scale_fill_manual(values = custom_colors)
ggsave("../output_figures/figure_S3A_continents_alluvial.png", width = 7, height = 7, dpi = 500, limitsize = F, plot = last_plot())
# Cumulative percentage of three main authors affiliation mentions.
composition_continent %>% group_by(continents_gr) %>% summarise(cumpercent = sum(percent))
(income_alluvial <- composition_income %>%
plot_composition("income_ISO3", "team_income") +
geom_text(stat = "flow",
aes(label = paste0(as.character(round(percent)), '%')),
nudge_x = .25,
check_overlap = T,
size = 3) +
geom_label(aes(x = 2, y = 10000, label = "Low income"), size = 3, fill = "white", label.size = NA) +
scale_x_continuous(breaks = 1:2, labels = c("Country salience \n by income groups", "Composition of authors \n  by income groups")))
ggsave("../output_figures/figure_4_income_alluvial.png", width = 7, height = 7, dpi = 500, limitsize = F, plot = last_plot())
# Based on migration relevance.
# CIV removed research salience is very low and plot is not useful.
ei_ctry <- aggregates %>% filter(ISO3 != "CIV") %>% group_by(continent) %>% arrange(-emig_immig) %>% slice(1:1)
sel_alluvial <- c(ei_ctry$ISO3, "SYR", "VEN", "AFG")
sel_alluvial_mig <- c(ei_ctry$ISO3)
sel_alluvial_crisis <- c("SYR", "VEN", "AFG")
bar_countries_time_mig <- composition_continents_ctry_time %>%
filter(ISO3 %in% sel_alluvial_mig) %>%
ggplot() +
geom_bar(mapping = aes(x = pubyear, y = n, group = team_continent, fill = team_continent), stat = "identity") +
facet_wrap(~ country_nm_fct, scales = "free", ncol = 3) +
theme_minimal(base_size = 16) +
scale_fill_manual(values = custom_colors) + # custom_colors defined for previous plot with continents.
theme(
legend.position = "bottom") +
labs(title = "Migration relevance",
fill = "Composition of authors",
y = "Research salience",
x = "Publication year")
bar_countries_time_cri <- composition_continents_ctry_time %>%
filter(ISO3 %in% sel_alluvial_crisis) %>%
ggplot() +
geom_bar(mapping = aes(x = pubyear, y = n, group = team_continent, fill = team_continent), stat = "identity") +
facet_wrap(~ country_nm, scales = "free") +
theme_minimal(base_size = 16) +
scale_fill_manual(values = custom_colors) +
theme(
legend.position = "none") +
labs(title = "Migration crisis",
fill = "Composition of authors",
y = "Research salience",
x = "Publication year")
combined_bar_countries <- bar_countries_time_mig / bar_countries_time_cri
ggsave("../output_figures/figure_5_countries_time.png",  width = 10, height = 12, dpi = 600, plot = last_plot())
rm(list = ls())
Sys.setenv(LANG = "en")
library(xlsx)
library(readr)
library(readxl)
library(tidyverse)
library(stringr)
library(stringi)
library(gghighlight)
library(countrycode)
library(countries)
library(janitor)
library(sf)
library(janitor)
library(sf)
library(ggthemes)
library(here)
library(viridis)
library(ggplot2)
library(formatR)
library(gtools)
library(nnet)
library(patchwork)
library(ggh4x)
library(plm)
library(broom)
library(ggalluvial)
library(pals)
aggregates <- read_csv("../aggregated_data/aggregates.csv")
aggregates_year <- read_csv("../aggregated_data/aggregates_year.csv")
aggregates_year <- aggregates_year %>%
mutate(subregion_rf = as_factor(subregion),
subregion_rf = relevel(subregion_rf, "Northern America"),
continent = as_factor(continent),
continent = relevel(continent, "Americas"))
myColors <- alphabet2()
names(myColors) <- levels(aggregates_year$subregion_rf)
(salience_subregions <- aggregates_year %>%
filter(!is.na(subregion_rf)) %>%
group_by(pubyear, continent, subregion_rf) %>%
summarise(n = sum(art_country_y)) %>%
ggplot() +
geom_bar(mapping = aes(x = pubyear, y = n, group = subregion_rf, fill = subregion_rf), stat = "identity") +
facet_wrap(vars(continent)) +
theme_minimal() +
theme(legend.title = element_blank(),
legend.text = element_text(size = 22),
legend.position = "bottom",
axis.text = element_text(size = 25),
axis.title=element_text(size = 25),
strip.text = element_text(size = 25)) +
labs(fill = "Subregion UN classification",
y = "Research salience",
x = "Publication year") +
scale_fill_manual(name = "subregion_rf", values = myColors))
ggsave("../output_figures/subregions_year_abs.png", width = 50, height = 30, units = "cm", dpi = 700, scale = 1, plot = last_plot())
(repr_subregions <- aggregates_year %>%
filter(!is.na(subregion_rf)) %>%
count(continent, subregion_rf, pubyear, repr_y_s) %>%
filter(repr_y_s == "Under") %>%
ggplot() +
geom_bar(mapping = aes(x = pubyear, y = n, group = subregion_rf, fill = subregion_rf), stat = "identity") +
facet_wrap(vars(continent)) +
theme_minimal() +
theme(legend.title = element_blank(),
legend.text = element_text(size = 22),
legend.position = "bottom",
axis.text = element_text(size = 25),
axis.title=element_text(size = 25),
strip.text = element_text(size = 25)) +
labs(fill = "Subregion UN classification",
y = "Counts of under-rerepresented countries",
x = "Publication year") +
scale_fill_manual(name = "subregion_rf", values = myColors))
ggsave("../output_figures/representation_subregions_year_abs.png", width = 50, height = 30, units = "cm", dpi = 700, scale = 1, plot = last_plot())
(repr_subregions <- aggregates_year %>%
filter(!is.na(subregion_rf)) %>%
count(continent, subregion_rf, pubyear, repr_y_s) %>%
filter(repr_y_s == "Under") %>%
ggplot() +
geom_bar(mapping = aes(x = pubyear, y = n, group = subregion_rf, fill = subregion_rf), stat = "identity") +
facet_wrap(vars(continent)) +
theme_minimal() +
theme(legend.position = "none",
axis.text = element_text(size = 25),
axis.title=element_text(size = 25),
strip.text = element_text(size = 25)) +
labs(fill = "Subregion UN classification",
y = "Counts of under-rerepresented countries",
x = "Publication year") +
scale_fill_manual(name = "subregion_rf", values = myColors))
salience_subregions / repr_subregions
ggsave("../output_figures/subregions_both.png", width = 50, height = 60, units = "cm", dpi = 700, scale = 1, plot = last_plot())
rm(list = ls())
Sys.setenv(LANG = "en")
library(xlsx)
library(readr)
library(readxl)
library(tidyverse)
library(stringr)
library(stringi)
library(gghighlight)
library(countrycode)
library(countries)
library(janitor)
library(sf)
library(janitor)
library(sf)
library(ggthemes)
library(here)
library(viridis)
library(ggplot2)
library(formatR)
library(gtools)
library(nnet)
library(patchwork)
library(ggh4x)
library(plm)
library(broom)
library(ggalluvial)
library(pals)
aggregates <- read_csv("../aggregated_data/aggregates.csv")
aggregates_year <- read_csv("../aggregated_data/aggregates_year.csv")
aggregates_year <- aggregates_year %>%
mutate(subregion_rf = as_factor(subregion),
subregion_rf = relevel(subregion_rf, "Northern America"),
continent = as_factor(continent),
continent = relevel(continent, "Americas"))
regr_numeric <- c("population_n",
"immig_stock",
"immig_relative_stock",
"emig_stock",
"emig_stock_rel_ctry",
"research_GDP",
"research",
"GDP")
aggregates_mod <- aggregates_year %>%
filter(!is.na(ISO3)) %>%
filter(pubyear %in% c(1996, 2000, 2005, 2010, 2015, 2020),
!is.na(GDP) & !is.na(research)) %>%
mutate(repr_y_s_2 = as.factor(if_else(repr_y_s %in% c("Fair", "Over"), 0, 1)),
across(all_of(regr_numeric), ~ .x + 0.000000000001))
tidy_r1 <- function(reg) {
reg %>% tidy(conf.int = TRUE) %>%
filter(!str_detect(term, 'pubyear'),
!term %in% c("(Intercept)", "log(population_n)")) %>%
mutate(term = str_remove(term, "subregion_rf"),
term = str_remove(term, "continent"),
term = case_when(
term == "log(GDP)" ~  "GDPpc",
term == "log(research_GDP)" ~  "Research as % of GDPpc",
term == "gsouthGlobal South" ~ "Global South",
term == "log(emig_stock)" ~ "Emigration stock",
term == "log(immig_stock)" ~ "Immigration stock",
TRUE ~ term),
term = fct_reorder(term, estimate),
significant = if_else(p.value <= 0.05, false = 0, 1),
effects = case_when(
estimate < 0 ~ "over",
estimate == 0 ~ "fair",
estimate > 0 ~ "under"
))
}
plot_reg <- function(reg_tidy, ptitle) {
reg_tidy %>%
filter(term != "(Intercept)") %>%
ggplot(aes(estimate, term)) +
geom_point(aes(color = factor(significant))) +
geom_errorbarh(aes(xmin = conf.low, xmax = conf.high, color = factor(significant)), height = 0) +
geom_vline(xintercept = 0, lty = 2) +
theme_minimal() +
theme(axis.text = element_text(size = 7),
axis.title.x = element_text(size = 6),
legend.position="none",
plot.title = element_text(size=8)) +
labs(title = ptitle,
y = NULL,
x = "Regression coefficient") +
scale_color_manual(values=c("0" = "#434343", "1" = "#6BA2D6"))
}
r1_continent <- lm(as.numeric(repr_y_s_2) ~ as.factor(pubyear) + continent + log(population_n) + log(GDP) + log(research_GDP), aggregates_mod)
r1_region <- lm(as.numeric(repr_y_s_2) ~ as.factor(pubyear) + subregion_rf + log(population_n) + log(GDP) + log(research_GDP), aggregates_mod)
#Absolute stocks
r2_continent <- lm(log(as.numeric(art_country_y)) ~ as.factor(pubyear) + continent + log(population_n) + log(GDP) + log(immig_stock) + log(emig_stock) + log(research_GDP), aggregates_mod)
r2_region <- lm(log(as.numeric(art_country_y))  ~ as.factor(pubyear) + subregion_rf + log(population_n) + log(GDP) + log(immig_stock) + log(emig_stock) + log(research_GDP), aggregates_mod)
#Relative stocks
r2_continent_rel <- lm(log(as.numeric(art_country_y)) ~ as.factor(pubyear) + continent + log(population_n) + log(GDP) + log(immig_relative_stock) + log(emig_stock_rel_ctry) + log(research_GDP), aggregates_mod)
r2_region_rel <- lm(log(as.numeric(art_country_y))  ~ as.factor(pubyear) + subregion_rf + log(population_n) + log(GDP) + log(immig_relative_stock) + log(emig_stock_rel_ctry) + log(research_GDP), aggregates_mod)
# Under-research
r1_continent_tidy <- r1_continent %>% tidy_r1
(r1_continent_plot <- r1_continent_tidy %>% plot_reg("1A - Underrepresentation:\n Continents"))
ggsave("../output_figures/cplot_continent.png", plot = last_plot())
r1_region_tidy <- r1_region %>% tidy_r1
(r1_region_plot <- r1_region_tidy %>% plot_reg("1B - Underrepresentation:\n Subregions"))
ggsave("../output_figures/cplot_subregion.png", plot = last_plot())
# Research salience
r2_continent_tidy <- r2_continent %>% tidy_r1
(r2_continent_plot <- r2_continent_tidy %>% plot_reg("2A - Salience:\n Continents"))
ggsave("../output_figures/cplot_counts_continent.png", plot = last_plot())
r2_region_tidy <- r2_region %>% tidy_r1
(r2_region_plot <- r2_region_tidy %>% plot_reg("2B - Salience:\n Subregions"))
ggsave("../output_figures/cplot_counts_subregion.png", plot = last_plot())
# Research salience. Relative.Note the results are exactly the same as with absolute numbers!
r2_continent_rel_tidy <- r2_continent_rel %>% tidy_r1
(r2_continent_rel_plot <- r2_continent_rel_tidy %>% plot_reg("Model S.1:Continents"))
ggsave("../output_figures/cplot_counts_continent_rel.png", plot = last_plot())
r2_region_rel_tidy <- r2_region_rel %>% tidy_r1
(r2_region_rel_plot <- r2_region_rel_tidy %>% plot_reg("Model S.2: Subregions"))
ggsave("../output_figures/cplot_counts_subregion_rel.png", plot = last_plot())
r1_continent_plot / r1_region_plot #/ r1_gsouth_plot
ggsave("../output_figures/cplot_combined.png", width = 6, height = 7, dpi = 500, limitsize = F, plot = last_plot())
r2_continent_plot / r2_region_plot #/ r2_gsouth_plot
ggsave("../output_figures/cplot_counts_combined.png", width = 6, height = 7, dpi = 500, limitsize = F, plot = last_plot())
(r1_continent_plot + r1_region_plot) / (r2_continent_plot + r2_region_plot)
ggsave("../output_figures/cplot_all.png", width = 6, height = 7, dpi = 500, limitsize = F, plot = last_plot())
rm(list = ls())
Sys.setenv(LANG = "en")
library(tidyverse)      # Includes dplyr, ggplot2, readr, purrr, stringr
library(countrycode)
library(ggalluvial)
library(RColorBrewer)
library(viridis)
library(patchwork)
file_names <- c(
"composition_subregions",
"composition_continent",
"composition_income",
"composition_continents_ctry_time",
"composition_continents_ctry"
)
# Read CSVs into a named list
df_list <- map(file_names, ~read_csv(paste0("../aggregated_data/", .x, ".csv")))
names(df_list) <- file_names
# Assign each list element to a variable
list2env(df_list, envir = .GlobalEnv)
aggregates <- read_csv("../aggregated_data/aggregates.csv")
plot_composition <- function(df, var1, var2) {
if (is.character(var1) && is.character(var2)) {
var1 <- ensym(var1)
var2 <- ensym(var2)
}
df %>%
ggplot(aes(y = n, axis1 = !!var1, axis2 = !!var2)) +
geom_alluvium(aes(fill = !!var2)) +
geom_stratum() +
geom_label(stat = "stratum",
aes(label = after_stat(stratum)),
size = 3,
label.size = NA) +
theme(legend.position = "none") +
labs(y = "Country salience") +
scale_fill_viridis_d() +
scale_x_continuous(breaks = 1:2, labels = c("Country salience \n by region", "Composition of authors \n by region")) +
coord_cartesian(xlim = c(0.8, 2.13))
}
options(scipen = 999)
composition_subregions %>%
plot_composition("subregion_gr", "team_subregion")
ggsave("../output_figures/figure_S3B_subregions_alluvial.png", width = 7, height = 7, dpi = 500, limitsize = F, plot = last_plot())
# Choose a qualitative palette with up to 8–12 distinct colors
team_continent_cats <- c("Northern America", "Europe", "Asia", "Collaboration", "Africa", "Oceania", "Lat.America & Car.")
n_colors <- length(team_continent_cats)
custom_colors <- brewer.pal(n = n_colors, name = "Set2")
(continents_alluvial <- composition_continent %>%
plot_composition("continents_gr", "team_continent") +
geom_text(stat = "flow",
aes(label = paste0(as.character(round(percent)), '%')),
nudge_x = .25,
check_overlap = T,
size = 3)) +
scale_fill_manual(values = custom_colors)
ggsave("../output_figures/figure_S3A_continents_alluvial.png", width = 7, height = 7, dpi = 500, limitsize = F, plot = last_plot())
# Cumulative percentage of three main authors affiliation mentions.
composition_continent %>% group_by(continents_gr) %>% summarise(cumpercent = sum(percent))
(income_alluvial <- composition_income %>%
plot_composition("income_ISO3", "team_income") +
geom_text(stat = "flow",
aes(label = paste0(as.character(round(percent)), '%')),
nudge_x = .25,
check_overlap = T,
size = 3) +
geom_label(aes(x = 2, y = 10000, label = "Low income"), size = 3, fill = "white", label.size = NA) +
scale_x_continuous(breaks = 1:2, labels = c("Country salience \n by income groups", "Composition of authors \n  by income groups")))
ggsave("../output_figures/figure_4_income_alluvial.png", width = 7, height = 7, dpi = 500, limitsize = F, plot = last_plot())
# Based on migration relevance.
# CIV removed research salience is very low and plot is not useful.
ei_ctry <- aggregates %>% filter(ISO3 != "CIV") %>% group_by(continent) %>% arrange(-emig_immig) %>% slice(1:1)
sel_alluvial <- c(ei_ctry$ISO3, "SYR", "VEN", "AFG")
sel_alluvial_mig <- c(ei_ctry$ISO3)
sel_alluvial_crisis <- c("SYR", "VEN", "AFG")
bar_countries_time_mig <- composition_continents_ctry_time %>%
filter(ISO3 %in% sel_alluvial_mig) %>%
ggplot() +
geom_bar(mapping = aes(x = pubyear, y = n, group = team_continent, fill = team_continent), stat = "identity") +
facet_wrap(~ country_nm_fct, scales = "free", ncol = 3) +
theme_minimal(base_size = 16) +
scale_fill_manual(values = custom_colors) + # custom_colors defined for previous plot with continents.
theme(
legend.position = "bottom") +
labs(title = "Migration relevance",
fill = "Composition of authors",
y = "Research salience",
x = "Publication year")
bar_countries_time_cri <- composition_continents_ctry_time %>%
filter(ISO3 %in% sel_alluvial_crisis) %>%
ggplot() +
geom_bar(mapping = aes(x = pubyear, y = n, group = team_continent, fill = team_continent), stat = "identity") +
facet_wrap(~ country_nm, scales = "free") +
theme_minimal(base_size = 16) +
scale_fill_manual(values = custom_colors) +
theme(
legend.position = "none") +
labs(title = "Migration crisis",
fill = "Composition of authors",
y = "Research salience",
x = "Publication year")
combined_bar_countries <- bar_countries_time_mig / bar_countries_time_cri
ggsave("../output_figures/figure_5_countries_time.png",  width = 10, height = 12, dpi = 600, plot = last_plot())
composition_continents_ctry %>%
plot_composition("country_nm", "team_continent") +
scale_fill_manual(values = custom_colors) +
scale_x_continuous(breaks = 1:2, labels = c("Country salience \n in selected countries", "Composition of authors \n  by region"))
ggsave("../output_figures/figure_S4_countries_continents_alluvial.png", width = 7, height = 7, dpi = 500, limitsize = F, plot = last_plot())
# Main continent researching about the country
composition_max_labels <- composition_continents_ctry %>%
group_by(country_nm) %>%
slice_max(percent, n = 1, with_ties = FALSE) %>%
ungroup()
composition_max_labels
